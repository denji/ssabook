%% Change styles of chapters, sections and subsections

\titleformat{\chapter}[display]
  {\bfseries\Large}
  {\filleft\MakeUppercase{\chaptertitlename} \Huge\thechapter}
  {4ex}
  {\titlerule
   \vspace{2ex}%
   \filright}
  [\vspace{2ex}%
   \titlerule]

\titleformat{\section}[hang]
  {\normalfont
   \titlerule*[.7em]{\bfseries.}%
   \vspace{6pt}%
   \sffamily\bfseries\Large}
  {\setbox0\hbox{\thesection}%
  \kern-\wd0\kern-.5em\box0}{.5em}{}

\titleformat{\subsection}[hang]
  {\itshape\bfseries\large}
  {\setbox0\hbox{\thesubsection}%
  \kern-\wd0\kern-.5em\box0}{.5em}{}

\titleformat{\subsubsection}[hang]
  {\itshape\large}
  {\setbox0\hbox{\thesubsubsection}%
  \kern-\wd0\kern-.5em\box0}{.5em}{}


%% Change caption styles

% Make labels of figure and tables stick into the left margin
\DeclareCaptionFormat{marginlabel}{%
  \setbox0\hbox{#1#2}{\kern-\wd0\box0#3}%
}

\captionsetup{%
  font=small,%
  labelfont=bf,%
  format=marginlabel,%
  labelsep=quad,%
  justification=justified,%
  singlelinecheck=false%  do not center single line captions
}
\captionsetup[subfloat]{%
  format=plain,%
%  labelfont={bf,it},%
  singlelinecheck=true% center single line captions
}
